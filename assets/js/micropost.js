!async function(){async function e(){let e,o=[];for(;o.length<t;){const t=new URL(a);t.searchParams.set("limit",n),e&&t.searchParams.set("pageToken",e);const i=await fetch(t,{headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`HTTP ${i.status}`);const s=await i.json(),c=Array.isArray(s)?s:s.memos||[];if(o.push(...c),e=s.nextPageToken,!e||0===c.length)break}return o.slice(0,t)}const t=30,n=30,a="https://memos.jinjunliu.com/api/v1/memos",o="https://memos.jinjunliu.com/file/",i="https://memos.jinjunliu.com/";marked.setOptions({gfm:!0,breaks:!0,headerIds:!1,mangle:!1});const s=e=>e.replace(/[&<>\"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))),c=e=>`<figure class="micropost-img">\n          <img src="${o}${e.name}/${encodeURIComponent(e.filename)}"\n               alt="${s(e.filename)}">\n          <figcaption>${s(e.filename)}</figcaption>\n       </figure>`,r=document.getElementById("micropost-container");try{const t=await e(),n=Object.fromEntries(t.map((e=>[e.name,e])));r.innerHTML=t.map((e=>{let t=(e.content||"").replace(/!\[\[(memos\/[A-Za-z0-9]+)\]\]/g,((e,t)=>`<blockquote class="memo-embed">${n[t]?marked.parse(n[t].content||""):`<a href="${i}${t}">${t}</a>`}</blockquote>`));const a=marked.parse(t),o=(e.resources||[]).filter((e=>e.type?.startsWith("image/"))).map(c).join(""),s=o?`<div class="micropost-gallery">${o}</div>`:"",r=e.createdTs?new Date(1e3*e.createdTs):new Date(e.createTime||e.displayTime||Date.now());return`\n<section class="micropost">\n  <div class="micropost-meta">\n    <time datetime="${r.toISOString()}">\n      ${r.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}\n    </time>\n  </div>\n  <div class="micropost-body">\n    ${a}\n    ${s}\n  </div>\n</section>`})).join("")}catch(e){r.innerHTML="<p>Failed to load microposts.</p>"}}(),document.addEventListener("click",(e=>{const t=e.target.closest(".micropost-gallery img");if(!t)return;const n=document.createElement("div");n.className="lightbox",n.innerHTML=`<img src="${t.src}" alt="">`,n.addEventListener("click",(()=>n.remove())),document.body.appendChild(n)}));